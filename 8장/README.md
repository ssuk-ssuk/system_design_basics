# 8장: URL 단축기 설계

**학습 날짜:** 2026년 1월 2일 

## 1. URL 단축의 정의

단축 URL 서비스는 긴 원본 URL(Original URL)을 짧고 유일한 식별자(Short Key)로 매핑하여 제공하는 서비스입니다.

주요 기능 
* **URL 단축**: 원본 URL을 훨씬 짧은 URL로 줄임 
* **URL 리디렉션**: 축약된 URL로 요청이 오면 원래 URL로 안내 
* **시스템 요구사항**: 높은 가용성, 규모 확장성, 장애 감내 

### 단축 URL 사용 이유

* **URL 주소 은닉**: 내부 로직 ID 노출을 막아 ID 열거 공격(ID Enumeration)을 방지함 
* **데이터 분석**: 접속 로그 수집 로직을 메인 서버와 분리하여 부하 감소 
* **사용자 경험 개선**:
* 배포 후에도 목적지 주소 변경 가능 (이벤트 종료, 점검 등) 
* 한글/특수문자 인코딩으로 인한 링크 깨짐 및 길이 이슈 해결 
* SMS(80Byte 제한)나 트위터 등 글자 수 제한 플랫폼에서 비용 절감 


2. 설계를 위한 개략적 추정 

* **트래픽**: 매일 1억 개의 단축 URL 생성 
* 초당 쓰기 연산: 약 1,160회 
* 초당 읽기 연산: 약 11,600회 (쓰기:읽기 = 1:10 가정) 
* **저장 용량**: 10년 운영 시 약 3,650억 개의 레코드 보관, 약 36.5TB 이상의 용량 필요 
* **제한 사항**: 숫자(0-9)와 영문자(a-z, A-Z)만 사용 가능 (총 62개 문자) 


## 3. 기본 API 엔드포인트

1. **URL 단축용**: `POST /api/v1/data/shorten` (새 단축 URL 생성) 
2. **URL 리디렉션용**: `GET /api/v1/shortUrl` (원본 URL로 안내) 


301 vs 302 리디렉션 차이 
* **301 (Moved Permanently)**: 영구적 이전. 브라우저가 응답을 캐시하여 이후 요청 시 서버를 거치지 않고 바로 원본 URL로 접속함 (서버 부하 감소).
* **302 (Found)**: 일시적 이전. 브라우저가 캐시하지 않으므로 매번 단축 URL 서버를 거쳐야 함 (트래픽 분석 및 로그 수집에 유리).


## 4. URL 단축 방법 

방법 1: 해시 함수 

* **원리**: CRC32, MD5, SHA-1 등의 해시 함수를 사용.
* **충돌 해결**: 해시값의 처음 7글자만 사용하되, 충돌 발생 시 사전에 정한 문자열을 덧붙여 재해싱함.
* **특징**: DB 질의가 필요하여 오버헤드가 발생할 수 있으며, 블룸 필터로 성능 개선이 가능함.

방법 2: Base-62 변환 

* **원리**: 원본 URL에 대응하는 DB의 고유 ID(숫자)를 62진법으로 변환.
  * 예: 11157(10진수) → 2TX(62진수) 

* **장점**: ID의 유일성이 보장되면 충돌이 절대 발생하지 않음.
* **단점**: ID가 1씩 증가하는 구조일 경우 다음 URL을 예측하기 쉬워 보안에 취약할 수 있음.


## 5. 상세 설계 및 최적화

쓰기보다 읽기가 훨씬 많은 시스템 특성상 **로드밸런서**와 **캐시**를 활용하여 부하를 분산합니다.

리디렉션 처리 흐름 (캐시 포함) 

1. 사용자가 단축 URL로 접속 시도 
2. 로드밸런서를 거쳐 웹 서버로 전달 
3. **캐시**에서 먼저 해당 단축 URL의 원본 URL이 있는지 확인 
4. 캐시에 없으면 **데이터베이스**에서 조회 
5. 원본 URL을 사용자에게 반환하여 리디렉션 수행 
